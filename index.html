<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• T√≠nh T·ªâ L·ªá Discount</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for professional look and feel */
        body {
            /* ƒê·∫£m b·∫£o d√πng font Inter ƒë√£ import */
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-radius: 12px;
        }
        .metric-card {
            transition: all 0.3s ease;
            border-radius: 12px;
            /* Th√™m border-color m·∫∑c ƒë·ªãnh cho nh·ªØng card kh√¥ng c√≥ class m√†u */
            border: 1px solid #e0e7ff; 
        }
        .metric-card:hover {
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.1), 0 4px 6px -4px rgba(99, 102, 241, 0.1);
        }
        
        /* Input Field Styling */
        input[type="number"] {
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            transition: all 0.2s;
            background-color: white;
            /* TƒÉng ƒë·ªô d√†y font cho input ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n */
            font-weight: 500;
        }
        input[type="number"]:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
            outline: none;
        }

        /* ƒê·ªãnh nghƒ©a l·∫°i c√°c m√†u cho Metric Cards d·ª±a tr√™n class Tailwind */
        .metric-card.bg-green-50 { border-color: #a7f3d0; } /* green-300 */
        .metric-card.bg-yellow-50 { border-color: #fcd34d; } /* yellow-300 */
        .metric-card.bg-red-100 { border-color: #fca5a5; } /* red-300 */

    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2">
                üí∞ C√¥ng C·ª• T√≠nh Discount Cho Seller
            </h1>
            <p class="text-lg text-gray-600">
                Template t√≠nh M·ª©c Discount T·ªëi ∆Øu ƒë·ªÉ ch·ªët ƒë∆°n: Nhanh ‚Äì Chu·∫©n ‚Äì C√≥ L√£i R√≤ng ƒêa K√™nh
            </p>
        </header>

        <div class="space-y-10">

            <div class="card bg-white p-6 md:p-8">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 border-b pb-2">
                    1. D·ªØ Li·ªáu ƒê·∫ßu V√†o (ƒê∆°n v·ªã: VNƒê & %)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="cogs">Gi√° V·ªën (COGS)</label>
                        <input type="number" id="cogs" value="100000" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">Gi√° nh·∫≠p h√†ng/s·∫£n xu·∫•t</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="fixed_cost">Ph√≠ C·ªë ƒê·ªãnh/ƒê∆°n</label>
                        <input type="number" id="fixed_cost" value="20000" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">L∆∞∆°ng, m·∫∑t b·∫±ng (ph√¢n b·ªï)</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="list_price">Gi√° Ni√™m Y·∫øt (List Price)</label>
                        <input type="number" id="list_price" value="300000" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">Gi√° b√°n hi·ªán t·∫°i tr√™n m·ªçi k√™nh</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="target_margin">Target Net Margin (%)</label>
                        <input type="number" id="target_margin" value="30" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">M·ª©c % l√£i r√≤ng T·ªêI THI·ªÇU ph·∫£i ƒë·∫°t</p>
                    </div>
                </div>
            </div>

            <div class="card bg-white p-6 md:p-8 overflow-x-auto">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 border-b pb-2">
                    2. So S√°nh & M√¥ Ph·ªèng L√£i R√≤ng Theo K√™nh B√°n
                </h2>
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr class="text-gray-500 text-left text-sm uppercase tracking-wider bg-gray-50">
                            <th class="px-3 py-3 font-semibold w-1/4">Ch·ªâ S·ªë</th>
                            <th class="px-3 py-3 font-semibold w-1/4 text-center">Shopee</th>
                            <th class="px-3 py-3 font-semibold w-1/4 text-center">TikTok</th>
                            <th class="px-3 py-3 font-semibold w-1/4 text-center">OWNED CHANNEL</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 text-sm">
                        
                        <tr>
                            <td class="px-3 py-4 font-medium text-gray-900">Ph√≠ S√†n / Hoa H·ªìng (%)</td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="fee_a" value="10" class="w-20 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="fee_b" value="2" class="w-20 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="fee_c" value="5" class="w-20 text-center" oninput="calculateProfit()">
                            </td>
                        </tr>
                        <tr>
                            <td class="px-3 py-4 font-medium text-gray-900">Chi Ph√≠ Marketing/ƒê∆°n (VNƒê)</td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="mkt_a" value="20000" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="mkt_b" value="50000" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="mkt_c" value="0" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                        </tr>
                        <tr>
                            <td class="px-3 py-4 font-medium text-gray-900">Discount √Åp D·ª•ng (%)</td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="discount_a" value="0" class="w-20 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="discount_b" value="0" class="w-20 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="discount_c" value="20" class="w-20 text-center" oninput="calculateProfit()">
                            </td>
                        </tr>

                        <tr class="bg-indigo-50 font-bold">
                            <td class="px-3 py-4 text-indigo-700">Gi√° Ho√† V·ªën (Break-Even Price)</td>
                            <td class="px-3 py-4 text-center" id="bep_a"></td>
                            <td class="px-3 py-4 text-center" id="bep_b"></td>
                            <td class="px-3 py-4 text-center" id="bep_c"></td>
                        </tr>
                        <tr class="bg-red-50 font-bold">
                            <td class="px-3 py-4 text-red-700">Gi√° B√°n C·∫¶N ƒê·∫°t L√£i R√≤ng (TSP)</td>
                            <td class="px-3 py-4 text-center" id="tsp_a"></td>
                            <td class="px-3 py-4 text-center" id="tsp_b"></td>
                            <td class="px-3 py-4 text-center" id="tsp_c"></td>
                        </tr>
                        <tr class="bg-green-100 font-bold">
                            <td class="px-3 py-4 text-green-700 text-lg">L√ÉI R√íNG TH·ª∞C T·∫æ / ƒê∆†N</td>
                            <td class="px-3 py-4 text-center text-lg" id="net_profit_a"></td>
                            <td class="px-3 py-4 text-center text-lg" id="net_profit_b"></td>
                            <td class="px-3 py-4 text-center text-lg" id="net_profit_c"></td>
                        </tr>
                        <tr>
                            <td class="px-3 py-4 text-gray-900 font-medium">T·ª∑ l·ªá L√£i R√≤ng Th·ª±c T·∫ø (%)</td>
                            <td class="px-3 py-4 text-center" id="net_margin_a"></td>
                            <td class="px-3 py-4 text-center" id="net_margin_b"></td>
                            <td class="px-3 py-4 text-center" id="net_margin_c"></td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <div class="card bg-white p-6 md:p-8">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 border-b pb-2">
                    3. K·∫øt Qu·∫£ Chi·∫øn L∆∞·ª£c & Quy·∫øt ƒê·ªãnh
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-stretch">
                    
                    <div id="discount_card_b" class="metric-card p-6 text-center md:col-span-2 bg-green-50 border-green-300">
                        <p class="text-sm font-semibold text-green-700 mb-2 uppercase">DISCOUNT T·ªêI ƒêA CHO PH√âP T·∫†I K√äNH RI√äNG</p>
                        <p class="text-4xl sm:text-5xl font-extrabold text-green-800" id="max_discount_b">0 VNƒê (0%)</p>
                        <p class="text-base text-gray-600 mt-2">M·ª©c gi·∫£m gi√° t·ªëi ƒëa so v·ªõi Gi√° Ni√™m Y·∫øt c√≥ th·ªÉ √°p d·ª•ng ƒë·ªÉ v·∫´n ƒë·∫°t L√£i R√≤ng MONG MU·ªêN.</p>
                    </div>
                    
                    <div id="alert_card_c" class="metric-card p-6 text-center bg-yellow-50 border-yellow-300">
                        <p class="text-sm font-semibold text-yellow-700 mb-2">K·∫æT QU·∫¢</p>
                        <p class="text-3xl font-extrabold text-red-600" id="loss_alert">OK, C√ì L√ÉI</p>
                        <p class="text-xs text-gray-500 mt-1">L√£i r√≤ng th·ª±c t·∫ø n·∫øu b√°n v·ªõi Discount 20%</p>
                    </div>

                    <div class="metric-card p-4 text-center md:col-span-1 h-full default">
                        <p class="text-sm font-semibold text-indigo-500 mb-1">L√ÉI R√íNG TƒÇNG TH√äM (Uplift)</p>
                        <p class="text-3xl font-extrabold text-indigo-700" id="profit_uplift">0 VNƒê</p>
                        <p class="text-xs text-gray-500 mt-1">(Kho·∫£n l√£i tƒÉng th√™m khi k√©o 1 ƒë∆°n h√†ng t·ª´ S√†n v·ªÅ K√™nh Ri√™ng)</p>
                    </div>
                    
                    <div class="md:col-span-2 bg-indigo-50 border border-indigo-200 p-6 rounded-lg text-center h-full">
                        <p class="text-lg font-bold text-indigo-800 mb-3">T·ªëi ∆∞u L√£i R√≤ng TƒÉng Th√™m v·ªõi AI!</p>
                        <p class="text-gray-700 mb-4">
                            M·ª©c Discount T·ªëi ƒêa n√†y c·∫ßn ƒë∆∞·ª£c √°p d·ª•ng linh ho·∫°t, c√° nh√¢n h√≥a cho t·ª´ng kh√°ch h√†ng. <span class="font-semibold">Mesbox AI Agent</span> gi√∫p m√†y t·ª± ƒë·ªông t∆∞ v·∫•n gi√° c√° nh√¢n, ch·ªët ƒë∆°n gi√° tr·ªã cao tr√™n K√™nh Ri√™ng, gom data kh√°ch h√†ng v√† t·ªëi ∆∞u L√£i R√≤ng Uplift n√†y.
                        </p>
                        <a href="https://mesbox.com/" class="inline-block px-6 py-3 bg-indigo-600 text-white font-bold rounded-full hover:bg-indigo-700 transition duration-300">
                            T√¨m hi·ªÉu v·ªÅ Mesbox AI Agent ‚Üí
                        </a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá Vi·ªát Nam (VNƒê)
        const formatCurrency = (number) => {
            if (isNaN(number) || number === null) return 'N/A';
            // L√†m tr√≤n ƒë·∫øn h√†ng ngh√¨n g·∫ßn nh·∫•t ƒë·ªÉ d·ªÖ ƒë·ªçc
            const roundedNumber = Math.round(number / 1000) * 1000;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(roundedNumber).replace('‚Ç´', ' VNƒê');
        };

        // H√†m t√≠nh to√°n c·ªët l√µi
        const calculateProfit = () => {
            // L·∫•y d·ªØ li·ªáu Input Trung T√¢m
            const cogs = parseFloat(document.getElementById('cogs').value) || 0;
            const fixedCost = parseFloat(document.getElementById('fixed_cost').value) || 0;
            const listPrice = parseFloat(document.getElementById('list_price').value) || 0;
            // Target Margin Rate ph·∫£i ƒë∆∞·ª£c chia 100
            const targetMarginRate = (parseFloat(document.getElementById('target_margin').value) || 0) / 100;
            
            // C√†i ƒë·∫∑t Thu·∫ø (Simplification: Fixed 1.5% for all scenarios based on common tax rates for small sellers)
            const taxRate = 0.015;  

            // L·∫•y d·ªØ li·ªáu Bi·∫øn ƒê·ªïi K√™nh
            const scenarios = {
                a: { 
                    fee: (parseFloat(document.getElementById('fee_a').value) || 0) / 100, 
                    mkt: parseFloat(document.getElementById('mkt_a').value) || 0,
                    discount: (parseFloat(document.getElementById('discount_a').value) || 0) / 100
                },
                b: { 
                    fee: (parseFloat(document.getElementById('fee_b').value) || 0) / 100, 
                    mkt: parseFloat(document.getElementById('mkt_b').value) || 0,
                    discount: (parseFloat(document.getElementById('discount_b').value) || 0) / 100
                },
                c: { 
                    fee: (parseFloat(document.getElementById('fee_c').value) || 0) / 100, 
                    mkt: parseFloat(document.getElementById('mkt_c').value) || 0,
                    discount: (parseFloat(document.getElementById('discount_c').value) || 0) / 100
                },
            };

            const results = {};

            // --- V√≤ng l·∫∑p t√≠nh to√°n cho t·ª´ng K·ªãch B·∫£n (A, B, C) ---
            for (const key in scenarios) {
                const s = scenarios[key];
                
                // 1. Gi√° b√°n th·ª±c t·∫ø sau khi √°p d·ª•ng discount
                const sellingPrice = listPrice * (1 - s.discount);

                // 2. T·ªïng Chi Ph√≠ V·ªën + V·∫≠n H√†nh + MKT (C·ªë ƒë·ªãnh & Bi·∫øn ƒë·ªïi)
                const totalCostBasis = cogs + fixedCost + s.mkt;

                // 3. T·ªïng Ph√≠ Bi·∫øn ƒê·ªïi (Ph√≠ S√†n/Hoa H·ªìng + Thu·∫ø) d·ª±a tr√™n Gi√° B√°n Th·ª±c T·∫ø
                const totalVariableFeeRate = s.fee + taxRate;
                const variableFees = sellingPrice * totalVariableFeeRate;

                // 4. L√£i R√≤ng Th·ª±c T·∫ø (NET PROFIT)
                const netProfit = sellingPrice - totalCostBasis - variableFees;

                // 5. T·ª∑ l·ªá L√£i R√≤ng Th·ª±c T·∫ø (%)
                const netMargin = (netProfit / sellingPrice) * 100;

                // 6. Gi√° Ho√† V·ªën (Break-Even Price - BEP)
                // BEP = Total Cost Basis / (1 - Total Variable Fee Rate)
                const bep = totalCostBasis / (1 - totalVariableFeeRate);

                // 7. Gi√° B√°n C·∫¶N ƒê·∫°t L√£i R√≤ng (Target Selling Price - TSP)
                // TSP = Total Cost Basis / (1 - Total Variable Fee Rate - Target Margin Rate)
                // L∆∞u √Ω: M·∫´u s·ªë ph·∫£i > 0 ƒë·ªÉ tr√°nh l·ªói NaN
                let tsp = NaN;
                if ((1 - totalVariableFeeRate - targetMarginRate) > 0) {
                    tsp = totalCostBasis / (1 - totalVariableFeeRate - targetMarginRate);
                }


                results[key] = {
                    netProfit: netProfit,
                    netMargin: netMargin,
                    bep: bep,
                    tsp: tsp,
                    sellingPrice: sellingPrice
                };

                // Hi·ªÉn th·ªã k·∫øt qu·∫£ v√†o B·∫£ng
                document.getElementById(`bep_${key}`).textContent = formatCurrency(bep);
                document.getElementById(`tsp_${key}`).textContent = formatCurrency(tsp);
                
                // Hi·ªÉn th·ªã L√£i R√≤ng Th·ª±c T·∫ø
                const profitEl = document.getElementById(`net_profit_${key}`);
                profitEl.textContent = formatCurrency(netProfit);
                profitEl.classList.toggle('text-red-600', netProfit < 0);
                profitEl.classList.toggle('text-green-700', netProfit >= 0);

                // Hi·ªÉn th·ªã T·ª∑ l·ªá L√£i R√≤ng
                document.getElementById(`net_margin_${key}`).textContent = `${netMargin.toFixed(1)}%`;
            }

            // --- C·∫≠p nh·∫≠t Khu V·ª±c 3: Quy·∫øt ƒê·ªãnh ---

            // 1. L√ÉI R√íNG TƒÇNG TH√äM (Uplift: K√™nh B - K√™nh A)
            const profitUplift = results.b.netProfit - results.a.netProfit;
            document.getElementById('profit_uplift').textContent = formatCurrency(profitUplift);
            document.getElementById('profit_uplift').parentElement.classList.toggle('bg-red-50', profitUplift < 0);
            document.getElementById('profit_uplift').parentElement.classList.toggle('bg-green-50', profitUplift > 0);
            
            // 2. Discount T·ªëi ƒêa Cho Ph√©p (K√™nh B)
            const maxDiscountValue = listPrice - results.b.tsp;
            const maxDiscountPercent = (maxDiscountValue / listPrice) * 100;
            const maxDiscountText = `${formatCurrency(maxDiscountValue)} (${maxDiscountPercent > 0 ? maxDiscountPercent.toFixed(1) : 0}%)`;

            document.getElementById('max_discount_b').textContent = maxDiscountText;
            
            // C·∫≠p nh·∫≠t m√†u s·∫Øc cho th·∫ª Discount
            const discountCard = document.getElementById('discount_card_b');
            
            if (maxDiscountValue < 0) {
                // Ph·∫£i b√°n cao h∆°n gi√° ni√™m y·∫øt ƒë·ªÉ ƒë·∫°t target margin
                discountCard.classList.remove('bg-green-50', 'border-green-300');
                discountCard.classList.add('bg-red-100', 'border-red-400');
                document.getElementById('max_discount_b').textContent = `PH·∫¢I TƒÇNG GI√Å! (${formatCurrency(-maxDiscountValue)})`;
            } else {
                discountCard.classList.remove('bg-red-100', 'border-red-400');
                discountCard.classList.add('bg-green-50', 'border-green-300');
                document.getElementById('max_discount_b').textContent = maxDiscountText;
            }
            
            // 3. C·∫£nh B√°o K·ªãch B·∫£n C
            const lossAlertEl = document.getElementById('loss_alert');
            const alertCard = document.getElementById('alert_card_c');
            
            if (results.c.netProfit < 0) {
                lossAlertEl.textContent = 'L·ªñ N·∫∂NG!';
                alertCard.classList.remove('bg-yellow-50', 'border-yellow-300');
                alertCard.classList.add('bg-red-100', 'border-red-400');
            } else {
                lossAlertEl.textContent = 'OK, C√ì L√ÉI';
                alertCard.classList.remove('bg-red-100', 'border-red-400');
                alertCard.classList.add('bg-yellow-50', 'border-yellow-300');
            }
        };

        // Ch·∫°y l·∫ßn ƒë·∫ßu khi t·∫£i trang
        window.onload = function() {
            calculateProfit();
        };

    </script>
</body>

</html>
